#!/usr/bin/env sh

set -eu

# You probably need to run the app in production mode to ensure the correct
# asset URLs are referenced.
export RAILS_ENV=production
export SECRET_KEY_BASE=dummy

# Create a production SQLite database and populate it with the app's data (see
# db/seeds.rb for how).
bundle exec rails db:setup

# Generate production-optimised assets with Sprockets and friends. This must be
#Â done before generating the Parklife build as Rails will blow up if it detects
# missing assets when running in production.
bundle exec rails assets:precompile

# Build with Parklife - and forward arguments sent to this script.
bundle exec parklife build "$@"

# Copy all public resources to ./build.
cp -R public/* build

# List all files in the build (useful for debugging).
find build -type f | sort
